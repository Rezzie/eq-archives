<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
	<meta name="keywords" content="Cisco (Corrupt Cookie), Rogue, Everquest, World of Warcraft, Vanguard, MMORPG, Roleplaying, Thief, Pirate, computer games, PC games, Pen & Paper, Sigil, SOE, EQ2, EQ, DAoC" />
	<meta name="description" content="[Archive] Cisco (Corrupt Cookie) The Workshop" />
		<title>Cisco (Corrupt Cookie) [Archive]  - The Safehouse Forums</title>
	<link rel="stylesheet" href="http://www.thesafehouse.org/forums/archive/archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="./">The Safehouse Forums</a> &gt; <a href="f-5.html">Main House</a> &gt; <a href="f-17.html">The Workshop</a> &gt; Cisco (Corrupt Cookie)</div>
<hr />
<div class="pda"><a href="?pda=1" rel="nofollow">PDA</a></div>
<p class="largefont">View Full Version : <a href="http://www.thesafehouse.org/forums/showthread.php?t=23995">Cisco (Corrupt Cookie)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Mithrilhall</div><div class="date">04-25-06, 11:58 AM</div></div><div class="posttext">How can I restore the cookie on this router using another 1711? Any suggestions would be welcomed.<br />
<br />
<br />
System Bootstrap, Version 12.2(7r)XM4, RELEASE SOFTWARE (fc1)<br />
TAC Support: http://www.cisco.com/tac<br />
Copyright (c) 2003 by cisco Systems, Inc.<br />
<br />
Warning: monitor nvram area is corrupt ... using default values<br />
environment checksum in NVRAM failed<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
<br />
Error writing NVRAM ... cannot size NVRAM<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
C1700 platform with 65536 Kbytes of main memory<br />
<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
loadprog: error - Invalid image for platform<br />
e_machine = 51, cpu_type = 110 <br />
boot: cannot load &quot;flash:&quot;<br />
<br />
System Bootstrap, Version 12.2(7r)XM4, RELEASE SOFTWARE (fc1)<br />
TAC Support: http://www.cisco.com/tac<br />
Copyright (c) 2003 by cisco Systems, Inc.<br />
<br />
Warning: monitor nvram area is corrupt ... using default values<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
<br />
Error writing NVRAM ... cannot size NVRAM<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
C1700 platform with 65536 Kbytes of main memory<br />
<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
rommon 1 &gt; dir flash:<br />
         File size           Checksum   File name<br />
  11720880 bytes (0xb2d8b0)   0xb70a    c1700-k9o3sy7-mz.123-7.T.bin<br />
   3176448 bytes (0x307800)   0x1c34    sdm.tar<br />
     16264 bytes (0x3f88)     0x1c9e    sdm.shtml<br />
    216064 bytes (0x34c00)    0xf287    home.tar<br />
      1462 bytes (0x5b6)      0x8c5e    home.html<br />
      2196 bytes (0x894)      0x3c5e    sdmconfig-1711-1712.cfg<br />
       660 bytes (0x294)      0x2170    vlan.dat<br />
rommon 2 &gt; sh cookie<br />
<br />
monitor: command &quot;sh&quot; not found<br />
rommon 3 &gt; cookie<br />
<br />
Bad checksum on cookie structure, resorting to backup copy<br />
<br />
Warning: Cookie information is corrupt<br />
<br />
cookie:<br />
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <br />
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <br />
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <br />
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <br />
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <br />
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <br />
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <br />
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <br />
rommon 4 &gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hordolin Awanagin</div><div class="date">04-25-06, 02:36 PM</div></div><div class="posttext">on good box: get the cookie contents (I think you can tftp it but not sure how, I'm a command line kinda guy)<br />
 <br />
then rommon: cookie on the bad one<br />
and type in the cookie.type the values after the :<br />
 <br />
example:<br />
 <br />
byte 0x00 - Version: 01 <br />
byte 0x01 - Vendor (Recommended Value: 0x01): 01 <br />
bytes 0x02-0x07 - Ethernet HW Address: 00 04 27 fe 00 ea <br />
 <br />
You'd type:<br />
01 01 04 27 fe 00 ea</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hordolin Awanagin</div><div class="date">04-25-06, 02:40 PM</div></div><div class="posttext">an aside: might want to use the board ID and MAC address of the bad one instead of the good one when you put in the new cookie info</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mithrilhall</div><div class="date">04-25-06, 06:24 PM</div></div><div class="posttext">Thanks Hordolin. I'll give it a shot tomorrow morning. I believe I can get the board ID by opening the chassis but I don't think the MAC is printed anywhere on the board.<br />
<br />
I was told I can just pick a logical one (off by a digit or two).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mithrilhall</div><div class="date">04-26-06, 06:32 AM</div></div><div class="posttext">Okay....I know I'm doing something wrong.<br />
<br />
Here is a cookie from a working 1711:<br />
<br />
<br />
rommon 1 &gt; cookie<br />
<br />
cookie:<br />
01 01 00 0e 84 d7 1f 28 33 00 01 ff 04 48 00 11 <br />
00 00 00 00 00 00 00 00 46 4f 43 07 52 32 44 5a <br />
46 01 00 00 00 00 00 00 00 ff ff ff 50 04 49 23 <br />
09 01 ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
rommon 2 &gt; <br />
<br />
<br />
The MAC address is 000e.84d7.1f28<br />
<br />
The Processor Board ID on the router with the dead cookie is:<br />
<br />
<br />
FOC08031NCT<br />
<br />
<br />
How do I convert the above Processor ID into something I can input into the cookie from rommon?<br />
<br />
Also, when I'm done editing the cookie do I just issue a reset?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hordolin Awanagin</div><div class="date">04-26-06, 06:40 AM</div></div><div class="posttext">Sec..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hordolin Awanagin</div><div class="date">04-26-06, 07:03 AM</div></div><div class="posttext">Need to know the ID for the good router so I make sure I put it in the right spot.<br />
Conversion of the ID for the bad router: 46 4f 43 07 52 32 44 5a 46 01<br />
 <br />
The ID starts at byte 0x18<br />
Looking at the good cookie it has the same MAC as the bad box.<br />
 <br />
No guarantee without the ID of the good router to make sure there hasn't been a change in the cookie layout but your new cookie should be:<br />
 <br />
01 01 00 0e 84 d7 1f 28 33 00 01 ff 04 48 00 11 <br />
00 00 00 00 00 00 00 00 46 4f 43 30 38 30 33 31 <br />
4e 43 54 00 00 00 00 00 00 ff ff ff 50 04 49 23 <br />
09 01 ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff <br />
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff<br />
 <br />
And yes, issue a reset. You might have to reload IOS (Depends on the cause of the corruption) but configs should still be there and the box should start working.<br />
 <br />
For info: layout of the cookie:<br />
 <br />
byte 0x00 - Version <br />
byte 0x01 - Vendor <br />
bytes 0x02-0x07 - Ethernet HW Address<br />
byte 0x08-0x08 - Processor <br />
byte 0x09-0x09 - NVRAM Size <br />
byte 0x0a-0x0a - CPU Speed <br />
byte 0x0b-0x0b - Unused<br />
bytes 0x0c-0x0d - On-board PM ID<br />
bytes 0x0e-0x0f - MAC Address Allocated<br />
bytes 0x10-0x17: 00 00 00 00 00 00 00 00 <br />
bytes 0x18-0x22: Processor board ID + CPU revision 0x301<br />
bytes 0x23-0x24 - Deviation<br />
bytes 0x25-0x2c: 00 00 00 00 ff ff ff 50 (50 should be cpu_type) <br />
bytes 0x2d-0x2d - Board Config<br />
bytes 0x2e-0x31: 49 11 ec 03 <br />
bytes 0x32-0x37 - WAN MAC Address<br />
bytes 0x38-0x3f: ff ff ff ff ff ff ff ff <br />
bytes 0x40-0x47: ff ff ff ff ff ff ff ff <br />
bytes 0x48-0x4f: ff ff ff ff ff ff ff ff <br />
bytes 0x50-0x57: ff ff ff ff ff ff ff ff <br />
bytes 0x58-0x5f: ff ff ff ff ff ff ff ff <br />
bytes 0x60-0x67: ff ff ff ff ff ff ff ff <br />
bytes 0x68-0x6f: ff ff ff ff ff ff ff ff <br />
bytes 0x70-0x77: ff ff ff ff ff ff ff ff <br />
bytes 0x78-0x7f: ff ff ff ff ff ff ff ff</div></div><hr />


<div id="copyright">vBulletin v3.5.3, Copyright &copy;2000-2007, Jelsoft Enterprises Ltd.</div>
</div>
</body>
</html>